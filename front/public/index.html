<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <title>Smart contract constructors marketplace</title>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
   
<script>

	l=console.log;

	function async_log(err, result) {
		l(result)
	}


   function runDeployContract(id) {
        var contractData = getContractDataFromBackend(42);
        deployContract(contractData);
    }

    function getContractDataFromBackend(id) {
        return {    contract_id: 42,
                     txs_to_send: [ { bytecode: '6060604052341561000f57600080fd5b61015f8061001e6000396000f3006060604052600436106100405763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663f72ec61b8114610045575b600080fd5b341561005057600080fd5b61009660046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061009895505050505050565b005b7fcf34ef537ac33ee1ac626ca1587a0a7e8e51561e5514f8cb36afa1c5102b3bab8160405160208082528190810183818151815260200191508051906020019080838360005b838110156100f65780820151838201526020016100de565b50505050905090810190601f1680156101235780820380516001836020036101000a031916815260200191505b509250505060405180910390a1505600a165627a7a7230582047fcc23e8545a178049f522976d0ccc66c7977e7e03df4ddef8bb5b2bf6515640029',
					                  abi: [{"constant":false,"inputs":[{"name":"msg","type":"string"}],"name":"logthis","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"msg","type":"string"}],"name":"Log","type":"event"}]
								} ] };
    }

	function getContractAddress(tx_hash) {
		w3.eth.getTransactionReceipt(tx_hash, function(err, receipt) {
			if (null == receipt)
				window.setTimeout(function(){ getContractAddress(tx_hash) }, 500);
			else
				alert('contractAddress:', receipt.contractAddress);
		});
	}

    function deployContract(contractData) {
        var cData = contractData['txs_to_send'][0];
        w3 = new Web3(web3.currentProvider);

		w3.eth.sendTransaction({data: cData['bytecode']}, function(err, tx_hash) {
		    l('tx_hash:', tx_hash);
			getContractAddress(tx_hash);
		});

    }

</script>
	<button onclick="runDeployContract(42);">go</button>
  </body>
</html>
